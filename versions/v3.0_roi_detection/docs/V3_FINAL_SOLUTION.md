# v3.0最终解决方案

## 问题总结

**三轮测试都失败了，缺陷率64-73%！**

| 版本 | 方法 | 缺陷率 | 问题 |
|------|------|--------|------|
| R1 | 局部Otsu(64×64) | 64.69% | 过度分割 |
| R2 | 局部Otsu(128×128) | 72.80% | 更过度 |
| R3 | 全局Otsu | 67.88% | 阈值0.498太高 |

## 根本原因

### ROI检测的问题

**当前配置：**
```
BrightnessThreshold: 0.30
通过率: 54.7%（包含了大量暗色区域）
```

**问题：**
- 0.30太低，ROI包含了管子之间的缝隙、阴影
- 这些暗色区域拉低了ROI的整体亮度
- 导致Otsu阈值偏高（0.498），把管子内部的正常区域也判为缺陷

### 全局Otsu的陷阱

**阈值0.498的含义：**
```
ROI内的灰度分布：
- 管子本体: 0.6-1.0（白色）
- 管子缝隙: 0.2-0.5（灰色/黑色）
- 真实缺陷: 0.0-0.3（黑色）

Otsu找到的最佳分割点: 0.498
→ 把所有<0.498的区域都判为缺陷
→ 包含了缝隙和管子的暗色部分
```

## 最终解决方案

### 策略1：严格的ROI检测（推荐）⭐⭐⭐⭐⭐

**目标：ROI只包含管子本体，排除缝隙**

**修改：**
```matlab
// ceramic_defect_pipeline.m 中的ROI参数
ROIBrightnessThreshold: 0.30 → 0.50  // 大幅提高，只保留真正的白色管子
```

**预期效果：**
- ROI覆盖率：49% → 30-35%（只有管子本体）
- ROI平均亮度：提高
- Otsu阈值：0.498 → 0.35-0.40（降低）
- 缺陷率：67.88% → 15-25%

### 策略2：使用固定低阈值（备选）⭐⭐⭐⭐

**原理：真实缺陷（裂纹、黑点）通常很暗（<0.3）**

**修改：ceramic_defect_pipeline.m**
```matlab
// 替换全局Otsu
% 使用固定低阈值检测暗色缺陷
fixedThreshold = 0.25;  // 只有很暗的区域才是缺陷
binaryGlobal = enhanced < fixedThreshold;
```

**预期效果：**
- 只检测明显的黑色缺陷
- 缺陷率：67.88% → 10-20%

### 策略3：形态学后处理（辅助）⭐⭐⭐

**增大形态学开运算半径，去除更多噪点**

```matlab
'MorphOpenRadius', 8, ...  // 从3增大到8
```

## 推荐执行方案

### 第一步：提高ROI亮度阈值（关键）

这是最根本的修复，确保ROI只包含真正的白色管子。

