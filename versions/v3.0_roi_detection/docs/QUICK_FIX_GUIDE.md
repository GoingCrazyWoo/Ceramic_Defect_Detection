# ROIæ£€æµ‹å¿«é€Ÿä¿®å¤æŒ‡å—

## ğŸ” å½“å‰é—®é¢˜

æ ¹æ®ä½ çš„åé¦ˆï¼š
1. **æ²¡æœ‰å®Œå…¨æ£€æµ‹åˆ°ç®¡å­** - å¯èƒ½æœ‰éƒ¨åˆ†ç®¡å­æœªè¦†ç›–
2. **ç®¡å­ä¹‹é—´çš„ç¼éš™ä¹Ÿè¢«åŒ…å«** - ROIè¦†ç›–ç‡67.8%å¤ªé«˜

## ğŸ¯ é—®é¢˜åŸå› 

**äº®åº¦é˜ˆå€¼0.15å¤ªä½äº†ï¼**
- ç®¡å­æ˜¯ç™½è‰²ï¼ˆäº®åº¦é«˜ï¼‰
- ç®¡å­ä¹‹é—´çš„ç¼éš™æ˜¯æ·±ç°è‰²ï¼ˆäº®åº¦ä¸­ç­‰ï¼‰
- èƒŒæ™¯æ˜¯é»‘è‰²ï¼ˆäº®åº¦ä½ï¼‰

å½“é˜ˆå€¼=0.15æ—¶ï¼š
```
âœ… ç™½è‰²ç®¡å­ï¼ˆäº®åº¦>0.4ï¼‰â†’ åŒ…å« âœ…
âš ï¸ ç°è‰²ç¼éš™ï¼ˆäº®åº¦0.15-0.3ï¼‰â†’ ä¹Ÿè¢«åŒ…å«äº†ï¼âŒ
âœ… é»‘è‰²èƒŒæ™¯ï¼ˆäº®åº¦<0.15ï¼‰â†’ æ­£ç¡®æ’é™¤ âœ…
```

**ç»“æœ**ï¼šç®¡å­+ç¼éš™éƒ½è¢«æ£€æµ‹ï¼Œå¯¼è‡´è¦†ç›–ç‡è¿‡é«˜

## ğŸ’¡ è§£å†³æ–¹æ¡ˆ

### ç«‹å³æµ‹è¯•å·¥å…·

æˆ‘åˆšåˆ›å»ºäº†ä¸¤ä¸ªè¯Šæ–­å·¥å…·ï¼š

#### 1. è¯¦ç»†å¯è§†åŒ–ï¼ˆæŸ¥çœ‹é—®é¢˜ï¼‰
```matlab
cd 'd:\Projects\PyCharm Projects\Ceramic_Defect_Detection\matlab'
visualize_roi_detail
```

**ä¼šæ˜¾ç¤º8ä¸ªå­å›¾ï¼š**
- å­å›¾4: ç»¿è‰²è¾¹ç•Œæ˜¯å¦è¦†ç›–æ‰€æœ‰ç®¡å­ï¼Ÿ
- å­å›¾5: çº¢è‰²åŒºåŸŸæ˜¯å¦åŒ…å«äº†ç¼éš™ï¼Ÿ
- å­å›¾6: **æœ€å…³é”®** - åªæ˜¾ç¤ºROIå†…çš„éƒ¨åˆ†ï¼Œé»‘è‰²=è¢«æ’é™¤
- å­å›¾7-8: åˆ‡ç‰‡åˆ†æï¼ŒæŸ¥çœ‹äº®åº¦åˆ†å¸ƒ

#### 2. é˜ˆå€¼æµ‹è¯•å·¥å…·ï¼ˆæ‰¾æœ€ä¼˜å‚æ•°ï¼‰
```matlab
cd 'd:\Projects\PyCharm Projects\Ceramic_Defect_Detection\matlab'
test_roi_threshold
```

**ä¼šæµ‹è¯•6ä¸ªä¸åŒé˜ˆå€¼ï¼š**
- 0.10, 0.15, 0.20, 0.25, 0.30, 0.35
- æ˜¾ç¤ºæ¯ä¸ªé˜ˆå€¼çš„ROIè¦†ç›–ç‡å’ŒåŒºåŸŸæ•°
- è‡ªåŠ¨æ¨èæœ€ä¼˜é˜ˆå€¼

## ğŸ”§ æ‰‹åŠ¨è°ƒæ•´æ–¹æ¡ˆ

### æ–¹æ¡ˆAï¼šæé«˜äº®åº¦é˜ˆå€¼ï¼ˆæ¨èï¼‰â­â­â­â­â­

```matlab
% åœ¨MATLABä¸­æµ‹è¯•
cd 'd:\Projects\PyCharm Projects\Ceramic_Defect_Detection\matlab'

% æµ‹è¯•é˜ˆå€¼0.25
roiMask = detect_ceramic_roi(Igray, ...
    'BrightnessThreshold', 0.25, ...  % ä»0.15æé«˜åˆ°0.25
    'HeightRange', [0.1, 0.9], ...
    'KeepSeparateTubes', true);

% æŸ¥çœ‹è¦†ç›–ç‡
coverage = sum(roiMask(:)) / numel(roiMask) * 100;
fprintf('è¦†ç›–ç‡: %.1f%%\n', coverage);

% å¯è§†åŒ–
figure; imshow(Igray); hold on;
boundaries = bwboundaries(roiMask);
for k = 1:length(boundaries)
    boundary = boundaries{k};
    plot(boundary(:,2), boundary(:,1), 'g', 'LineWidth', 2);
end
hold off;
title(sprintf('é˜ˆå€¼0.25 - è¦†ç›–ç‡%.1f%%', coverage));
```

**é¢„æœŸæ•ˆæœï¼š**
- è¦†ç›–ç‡ï¼š67.8% â†’ 40-50%
- åªåŒ…å«ç™½è‰²ç®¡å­ï¼Œæ’é™¤ç°è‰²ç¼éš™

### æ–¹æ¡ˆBï¼šæ›´ä¸¥æ ¼çš„å½¢æ€å­¦ï¼ˆå¤‡é€‰ï¼‰â­â­â­

```matlab
roiMask = detect_ceramic_roi(Igray, ...
    'BrightnessThreshold', 0.20, ...
    'HeightRange', [0.1, 0.9], ...
    'MorphOpenRadius', 20, ...  % ä»10å¢å¤§åˆ°20
    'MinAreaRatio', 0.08, ...   % ä»0.05æé«˜åˆ°0.08
    'KeepSeparateTubes', true);
```

**æ•ˆæœï¼š**
- å»é™¤æ›´å¤šå°çš„è¿é€šåŒºåŸŸï¼ˆå¯èƒ½æ˜¯ç¼éš™ï¼‰
- æé«˜æœ€å°é¢ç§¯è¦æ±‚

### æ–¹æ¡ˆCï¼šç»„åˆç­–ç•¥â­â­â­â­

```matlab
roiMask = detect_ceramic_roi(Igray, ...
    'BrightnessThreshold', 0.25, ...  % æé«˜é˜ˆå€¼
    'HeightRange', [0.15, 0.85], ...  % ç•¥å¾®ç¼©å°èŒƒå›´
    'MorphOpenRadius', 15, ...        % ä¸­ç­‰å»å™ª
    'MinAreaRatio', 0.06, ...         % ç•¥å¾®æé«˜é¢ç§¯è¦æ±‚
    'KeepSeparateTubes', true);
```

## ğŸ“Š ç†æƒ³çš„ROIåº”è¯¥æ˜¯

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å½“å‰å€¼ | çŠ¶æ€ |
|------|--------|--------|------|
| **ROIè¦†ç›–ç‡** | 40-55% | 67.8% | âŒ å¤ªé«˜ |
| **åŒºåŸŸæ•°é‡** | 10-15ä¸ª | ? | å¾…ç¡®è®¤ |
| **åŒ…å«å†…å®¹** | åªæœ‰ç™½è‰²ç®¡å­ | ç®¡å­+ç¼éš™ | âŒ é”™è¯¯ |

## ğŸš€ å»ºè®®æ‰§è¡Œæ­¥éª¤

### ç¬¬1æ­¥ï¼šæŸ¥çœ‹å½“å‰é—®é¢˜
```matlab
cd 'd:\Projects\PyCharm Projects\Ceramic_Defect_Detection\matlab'
visualize_roi_detail
```
**æŸ¥çœ‹å­å›¾6**ï¼Œé»‘è‰²åŒºåŸŸåº”è¯¥åªæ˜¯èƒŒæ™¯ï¼Œä¸åº”è¯¥åŒ…å«ç®¡å­

### ç¬¬2æ­¥ï¼šæµ‹è¯•æœ€ä¼˜é˜ˆå€¼
```matlab
test_roi_threshold
```
**æŸ¥çœ‹è¶‹åŠ¿å›¾**ï¼Œé€‰æ‹©è¦†ç›–ç‡åœ¨40-55%ä¹‹é—´çš„é˜ˆå€¼

### ç¬¬3æ­¥ï¼šåº”ç”¨æœ€ä¼˜å‚æ•°

å‡è®¾æµ‹è¯•åå‘ç°é˜ˆå€¼0.25æœ€å¥½ï¼Œä¿®æ”¹`ceramic_defect_pipeline.m`ï¼š

```matlab
% æ‰¾åˆ°è¿™ä¸€è¡Œï¼ˆçº¦ç¬¬199è¡Œï¼‰ï¼š
opts.ROIBrightnessThreshold = 0.15;

% æ”¹ä¸ºï¼š
opts.ROIBrightnessThreshold = 0.25;  % æˆ–test_roi_thresholdæ¨èçš„å€¼
```

### ç¬¬4æ­¥ï¼šé‡æ–°è¿è¡Œæ£€æµ‹
```matlab
auto_run
quick_view
```

## ğŸ” åˆ¤æ–­æ ‡å‡†

### âœ… ROIæ­£ç¡®çš„æ ‡å¿—ï¼š
1. å­å›¾6ä¸­ï¼Œé»‘è‰²åŒºåŸŸåªåŒ…å«ï¼š
   - æ·±è‰²èƒŒæ™¯ âœ…
   - ç®¡å­ä¹‹é—´çš„é»‘è‰²ç¼éš™ âœ…
   - å‰æ™¯æ”¯æ’‘æ†ï¼ˆå¯æ¥å—ï¼‰
   
2. ç™½è‰²åŒºåŸŸå®Œæ•´æ˜¾ç¤ºæ‰€æœ‰ç®¡å­ âœ…

3. ROIè¦†ç›–ç‡ï¼š40-55% âœ…

4. æ£€æµ‹åˆ°10-15ä¸ªç‹¬ç«‹åŒºåŸŸï¼ˆå¯¹åº”ç®¡å­æ•°é‡ï¼‰âœ…

### âŒ ROIé”™è¯¯çš„æ ‡å¿—ï¼š
1. å­å›¾6ä¸­ï¼Œé»‘è‰²åŒºåŸŸå¾ˆå°‘ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯ç™½è‰² âŒ
   â†’ è¯´æ˜åŒ…å«äº†å¤ªå¤šå†…å®¹ï¼ˆç¼éš™ï¼‰

2. å­å›¾4ä¸­ï¼Œç»¿è‰²è¾¹ç•Œè¿æˆä¸€å¤§ç‰‡ âŒ
   â†’ è¯´æ˜ç®¡å­è¢«è¿æ¥äº†ï¼ˆåº”è¯¥æ˜¯ç‹¬ç«‹çš„ï¼‰

3. ROIè¦†ç›–ç‡ >60% âŒ
   â†’ åŒ…å«äº†ç®¡å­ä¹‹é—´çš„ç¼éš™

4. æŸäº›ç®¡å­æ²¡æœ‰ç»¿è‰²è¾¹ç•Œ âŒ
   â†’ é˜ˆå€¼å¤ªé«˜ï¼Œæ¼æ£€äº†ç®¡å­

## ğŸ’¬ åé¦ˆç»™æˆ‘

è¿è¡Œ`visualize_roi_detail`å’Œ`test_roi_threshold`åï¼Œå‘Šè¯‰æˆ‘ï¼š

1. **test_roi_thresholdæ¨èçš„é˜ˆå€¼æ˜¯å¤šå°‘ï¼Ÿ**
2. **å“ªä¸ªé˜ˆå€¼çœ‹èµ·æ¥æœ€å¥½ï¼Ÿ**ï¼ˆä»0.10åˆ°0.35ï¼‰
3. **visualize_roi_detailçš„å­å›¾6ï¼Œé»‘è‰²åŒºåŸŸæ˜¯å¦åˆç†ï¼Ÿ**

æˆ‘ä¼šæ ¹æ®ä½ çš„åé¦ˆè¿›ä¸€æ­¥è°ƒæ•´ï¼

## ğŸ“ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

```matlab
% è¯Šæ–­å½“å‰é—®é¢˜
cd 'd:\Projects\PyCharm Projects\Ceramic_Defect_Detection\matlab'
visualize_roi_detail

% æµ‹è¯•æœ€ä¼˜é˜ˆå€¼
test_roi_threshold

% æ‰‹åŠ¨æµ‹è¯•ç‰¹å®šé˜ˆå€¼
Igray = im2double(rgb2gray(imread('../samples/20250929_defect_01.jpg')));
roiMask = detect_ceramic_roi(Igray, 'BrightnessThreshold', 0.25);
imshow(roiMask); title(sprintf('è¦†ç›–ç‡: %.1f%%', sum(roiMask(:))/numel(roiMask)*100));
```

