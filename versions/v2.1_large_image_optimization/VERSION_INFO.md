# v2.1 - 大图像优化版本

**日期**：2025-10-02  
**状态**：✅ 已优化，待测试  

## 版本概述

针对v2.0发现的问题进行参数优化，专门适配大尺寸图像（6000×8000）。

## 优化目标

1. 降低缺陷覆盖率：从 57% 降至 <20%
2. 减少圆形误检：从 350+ 降至 <150
3. 提升质量评分：从 47.5 提升至 >60
4. 改善对比度：从 -24% 提升至 >0%

## 参数调整详情

| 参数 | v2.0 | v2.1 | 变化 | 调整原因 |
|------|------|------|------|---------|
| **ClipLimit** | 0.015 | **0.02** | +33% | 改善对比度增强效果 |
| **NumTiles** | [8 8] | **[16 16]** | ×2 | 更精细的局部增强 |
| **LocalBlockSize** | [64 64] | **[256 256]** | ×4 | 适配6000×8000大图像 |
| **LocalOverlap** | [16 16] | **[64 64]** | ×4 | 配合块大小增大 |
| **MorphOpenRadius** | 2 | **3** | +50% | 更好去除噪声 |
| **LineFillGap** | 10 | **15** | +50% | 适配大图像的直线间隙 |
| **LineMinLength** | 30 | **50** | +67% | 减少短直线误检 |
| **CircleRadius** | [6 40] | **[8 30]** | 缩小 | 聚焦真实缺陷尺寸 |
| **CircleSensitivity** | 0.9 | **0.85** | -5.6% | 减少圆形误检 |
| **CircleEdgeThreshold** | 0.1 | **0.15** | +50% | 过滤弱边缘噪声 |

## 核心优化策略

### 1. 局部Otsu块大小调整
**问题**：64×64的块对6000×8000的图像太小，导致正常纹理变化被误判为缺陷

**解决**：
```matlab
% 计算公式：块大小 ≈ 图像宽度 × 4%
% 6000 × 4% = 240 ≈ 256
LocalBlockSize: [64 64] → [256 256]
```

**预期效果**：缺陷覆盖率从57%降至20%以下

### 2. 圆形检测灵敏度降低
**问题**：高灵敏度导致350+个圆形误检

**解决**：
```matlab
CircleSensitivity: 0.9 → 0.85  % 降低灵敏度
CircleRadius: [6 40] → [8 30]  % 缩小范围
CircleEdgeThreshold: 0.1 → 0.15  % 提高阈值
```

**预期效果**：圆形数量降至150以下

### 3. 对比度增强优化
**问题**：对比度改善为负值（-24%）

**解决**：
```matlab
ClipLimit: 0.015 → 0.02  % 提高对比度限制
NumTiles: [8 8] → [16 16]  % 增加分块精度
```

**预期效果**：对比度改善转为正值（>5%）

## 预期检测结果

| 指标 | v2.0实际 | v2.1目标 | 改善幅度 |
|------|---------|---------|---------|
| 缺陷覆盖率 | 57.0% | <20% | ↓ 65% |
| 圆形数量 | 353个 | <150个 | ↓ 58% |
| 质量评分 | 47.7 | >60 | ↑ 26% |
| 对比度改善 | -24% | >5% | ↑ 29% |

## 测试计划

### 测试步骤
1. 运行 `auto_run` 使用新参数
2. 对比新旧结果
3. 验证改善效果
4. 如需要继续微调

### 验证标准
- ✅ 缺陷覆盖率 <25%（优秀：<15%）
- ✅ 圆形数量 <150（优秀：<100）
- ✅ 质量评分 >60（优秀：>70）
- ✅ 对比度改善 >0%（优秀：>5%）

## 代码快照

参数配置文件：`code/ceramic_default_options.m`

## 运行结果

测试后将保存在：`run_results/`

## 测试结果（2025-10-03）

### ✅ 实际检测结果

| 指标 | v2.0 | v2.1 | 改善 | 目标 | 达成 |
|------|------|------|------|------|------|
| 缺陷覆盖率 | 57.0% | **53.9%** | ↓5.3% | <20% | ⚠️ 未达标 |
| 圆形数量 | 353 | **36** | ↓90% | <150 | ✅ 超额完成 |
| 质量评分 | 47.7 | **50.4** | ↑5.7% | >60 | 🟡 部分完成 |
| 直线数量 | 111 | **62** | ↓44% | - | ✅ 显著改善 |

**总结**：
- ✅ 圆形误检问题已基本解决
- ✅ 直线检测更加精准
- ⚠️ 缺陷覆盖率仍需继续优化（53.9% > 20%目标）

## 回滚方法

如果效果不理想，可以回滚到v2.0：

```matlab
% 复制v2.0参数文件
copyfile('versions/v2.0_baseline/code/ceramic_default_options.m', 'matlab/');
```

## 下一步优化方向（v2.2）

缺陷率仍然偏高（53.9%），需要创建v2.2继续优化：

### 推荐方案：组合优化
```matlab
'LocalBlockSize', [384 384], ...  % 继续增大块大小
'LocalOverlap', [96 96], ...      % 相应增大重叠
'MorphOpenRadius', 5, ...         % 增强形态学去噪
'ClipLimit', 0.025, ...           % 进一步提高对比度
```

### 预期效果
- 缺陷覆盖率：53.9% → <40%
- 保持圆形检测优势（<50个）
- 质量评分：50.4 → >55

